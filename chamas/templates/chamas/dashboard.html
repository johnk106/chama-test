{%extends 'chamas/base.html'%}{% load humanize %}
{%load static%}

{%block head%}
<title>Dashboard</title>
<link rel="stylesheet" href="{%static 'chamas/members.css'%}">
<link rel="stylesheet" href="{%static 'chamas/dashboard.css'%}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
{%endblock%}

{% block body %}
<div class="modern-dashboard">
    <!-- Mobile Header -->
    <div class="mobile-header d-block d-md-none">
        <div class="d-flex justify-content-between align-items-center">
            <button class="btn-hamburger" onclick="openNav()">
                <i class='bx bx-menu'></i>
            </button>
            <h1 class="header-title">Dashboard</h1>
            <div class="notification-badge-container">
                <button class="btn-notification">
                    <i class='bx bx-bell'></i>
                    {% if notifications.count > 0 %}
                        <span class="notification-badge">{{ notifications.count }}</span>
                    {% endif %}
                </button>
            </div>
        </div>
    </div>

    <!-- Desktop Header - Removed as requested -->

    <!-- Main Dashboard Content -->
    <div class="dashboard-content">
        <!-- Total Cash Card -->
        <div class="total-cash-card">
            <div class="cash-info">
                <p class="cash-label">Total Cash</p>
                <h1 class="cash-amount">Ksh {{total_savings|intcomma}}</h1>
                <div class="growth-indicator">
                    <i class='bx bx-trending-up'></i>
                    <span>15%</span>
                </div>
                <div class="cash-breakdown">
                    <div class="breakdown-item">
                        <span class="breakdown-label">Total contribution:</span>
                        <span class="breakdown-value">Ksh{{total_contributions|intcomma}}</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Total Loan:</span>
                        <span class="breakdown-value">Ksh{{total_loans|intcomma}}</span>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="doughnutChart" width="120" height="120"></canvas>
            </div>
        </div>

        <!-- Navigation Menu -->
        <div class="navigation-menu">
            <a href="{% url 'chamas:contributions' chama.id %}" class="nav-item">
                <div class="nav-icon">
                    <i class='bx bx-sort bx-rotate-90'></i>
                </div>
                <span class="nav-label">Contributions</span>
                <i class='bx bx-chevron-right nav-arrow'></i>
            </a>

            <a href="{% url 'chamas:chama-loans' chama.id %}" class="nav-item">
                <div class="nav-icon">
                    <i class='bx bxs-donate-heart'></i>
                </div>
                <span class="nav-label">Loans</span>
                <i class='bx bx-chevron-right nav-arrow'></i>
            </a>

            <a href="{% url 'chamas:chama-expenses' chama.id %}" class="nav-item">
                <div class="nav-icon">
                    <i class='bx bx-folder'></i>
                </div>
                <span class="nav-label">Expenses</span>
                <i class='bx bx-chevron-right nav-arrow'></i>
            </a>

            <a href="{% url 'chamas:chama-fines' chama.id %}" class="nav-item">
                <div class="nav-icon">
                    <i class='bx bx-file'></i>
                </div>
                <span class="nav-label">Fines</span>
                <i class='bx bx-chevron-right nav-arrow'></i>
            </a>

            <a href="{% url 'chamas:members' chama.id %}" class="nav-item">
                <div class="nav-icon">
                    <i class='bx bx-user'></i>
                </div>
                <span class="nav-label">Members</span>
                <i class='bx bx-chevron-right nav-arrow'></i>
            </a>

            <a href="{% url 'chamas:reports' chama.id %}" class="nav-item">
                <div class="nav-icon">
                    <i class='bx bxs-report'></i>
                </div>
                <span class="nav-label">Reports</span>
                <i class='bx bx-chevron-right nav-arrow'></i>
            </a>

            <a href="{% url 'chamas:notifications' chama.id %}" class="nav-item">
                <div class="nav-icon">
                    <i class='bx bx-bell'></i>
                </div>
                <span class="nav-label">Manage Notifications</span>
                <i class='bx bx-chevron-right nav-arrow'></i>
            </a>
        </div>

        <!-- Quick Stats (Desktop Only) -->
        <div class="quick-stats d-none d-lg-block">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class='bx bx-group'></i>
                </div>
                <div class="stat-info">
                    <h3>{{chama.member.count}}</h3>
                    <p>Total Members</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class='bx bx-money'></i>
                </div>
                <div class="stat-info">
                    <h3>Ksh {{total_fines|intcomma}}</h3>
                    <p>Total Fines</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class='bx bx-file'></i>
                </div>
                <div class="stat-info">
                    <h3>{{documents.count}}</h3>
                    <p>Documents</p>
                </div>
            </div>
        </div>

        <!-- Recent Activity (Desktop) -->
        <div class="recent-activity d-none d-lg-block">
            <h3>Recent Activity</h3>
            <div class="activity-list">
                {% for notification in notifications|slice:":5" %}
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class='bx bx-bell'></i>
                    </div>
                    <div class="activity-content">
                        <p class="activity-message">{{notification.message}}</p>
                        <span class="activity-time">{{notification.date|date:"M d, Y"}}</span>
                    </div>
                </div>
                {% empty %}
                <div class="activity-item">
                    <div class="activity-content">
                        <p class="activity-message">No recent activity</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Doughnut Chart
    const ctx = document.getElementById('doughnutChart').getContext('2d');
    const totalContributions = {{ total_contributions|default:0 }};
    const totalLoans = {{ total_loans|default:0 }};
    const totalSavings = {{ total_savings|default:0 }};
    
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Contributions', 'Loans', 'Available'],
            datasets: [{
                data: [totalContributions, totalLoans, Math.max(0, totalSavings - totalContributions - totalLoans)],
                backgroundColor: ['#059669', '#dc2626', '#06b6d4'],
                borderWidth: 0,
                cutout: '70%'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
});
</script>
{% endblock %}