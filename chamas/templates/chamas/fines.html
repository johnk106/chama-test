{%extends 'chamas/base.html'%} {%load static%} {% load humanize %} {% load avatar_filters %} 

{%block head%}
<title>Fines</title>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.body.classList.add('fines-page');
  });
</script>
<link rel="stylesheet" href="{%static 'chamas/fines.css'%}" />
<link rel="stylesheet" href="{%static 'chamas/contribution.css'%}" />
<link rel="stylesheet" href="{%static 'chamas/dashboard.css'%}" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
{%endblock%} {%block body%}

<div class="modern-fines">
    <!-- Mobile View -->
    <div class="mobile-fines d-block d-lg-none">
        <!-- Tabs -->
        <div class="mobile-tabs">
      <button class="tab-btn admin active" data-tab="create-fine">Create Fine</button>
      <button class="tab-btn admin" data-tab="impose-fine">Impose Fine</button>
      <button class="tab-btn admin" data-tab="loan-fines">Loan Fines</button>
      <button class="tab-btn admin" data-tab="contribution-fines">Contribution Fines</button>
      <button class="tab-btn member" data-tab="group-fines">Group Fines</button>
      <button class="tab-btn member" data-tab="my-loan-fines">My Loan Fines</button>
      <button class="tab-btn member" data-tab="my-contribution-fines">My Contribution Fines</button>
    </div>

    <!-- Create Fine Tab Content -->
    <div class="mobile-tab-content active" id="create-fine">
      <div class="mobile-create-form admin">
        <div class="create-fine-card">
          <div class="create-fine-header">
            <i class='bx bx-error-circle'></i>
            <span>Create Fine Type</span>
          </div>
          <div class="mobile-alert-hub"></div>
          <form id="mobile-create-fine-form" class="fine-card-form">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="mobile-fine-name">Name</label>
                  <input type="text" id="mobile-fine-name" name="name" class="form-input" placeholder="Enter fine name" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="mobile-fine-amount">Amount (KSH)</label>
                  <input type="number" id="mobile-fine-amount" name="amount" class="form-input" placeholder="Enter amount" required>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <div class="form-group">
                  <label for="mobile-fine-description">Description</label>
                  <textarea id="mobile-fine-description" name="description" class="form-input" rows="3" placeholder="Enter description" required></textarea>
                </div>
              </div>
            </div>
            <button type="submit" class="create-fine-btn beautiful-btn">
              Create Fine Type
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Impose Fine Tab Content -->
    <div class="mobile-tab-content" id="impose-fine">
      <div class="mobile-impose-alerts-hub"></div>
      <div class="mobile-fines-list">
        {% for loan in loans %}
        <div class="fine-member-card">
          <div class="fine-member-header">
            <div class="fine-member-info">
              {% if loan.member.profile %}
              <div class="fine-avatar" style="background-image: url({{loan.member.profile.url}});"></div>
              {% else %}
              <div class="fine-avatar"></div>
              {% endif %}
              <div class="fine-member-details">
                <h6>{{ loan.member.name }}</h6>
                <p>Loan: Ksh{{ loan.amount|floatformat:0 }} | Balance: Ksh{{ loan.balance|floatformat:0 }}</p>
              </div>
            </div>
            <i class="bx bx-chevron-down fine-toggle"></i>
          </div>
          <div class="fine-member-content">
            <form class="impose-fine-form">
              <input type="hidden" class="loan-id" value="{{ loan.id }}">
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <label for="fine-type-{{ loan.id }}">Fine Type</label>
                    <select name="fine-type" class="form-input fine-type" id="fine-type-{{ loan.id }}">
                      {% for type in fine_types %}
                      <option value="{{ type.id }}">{{ type.name }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>
              <button type="button" class="impose-fine-btn beautiful-btn impose-fine-button">
                Impose Fine
              </button>
            </form>
          </div>
        </div>
        {% empty %}
        <div class="no-fines">
          <i class='bx bx-inbox'></i>
          <p>No loans available for fines</p>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Loan Fines Tab Content -->
    <div class="mobile-tab-content" id="loan-fines">
      <div class="mobile-update-alerts-hub"></div>
      <div class="mobile-fines-list">
        {% for fine in fines %}
        <div class="fine-payment-card">
          <div class="fine-payment-header">
            <div class="fine-member-info">
              {% if fine.member.profile %}
              <div class="fine-avatar" style="background-image: url({{fine.member.profile.url}});"></div>
              {% else %}
              <div class="fine-avatar"></div>
              {% endif %}
              <div class="fine-member-details">
                <h6>{{ fine.member.name }}</h6>
                <p>Fine: Ksh{{ fine.fine_amount|floatformat:0 }} | Balance: Ksh{{ fine.fine_balance|floatformat:0 }}</p>
              </div>
            </div>
            <i class="bx bx-chevron-down fine-toggle"></i>
          </div>
          <div class="fine-payment-content">
            <div class="fine-details-grid">
              <div class="fine-detail-item">
                <div class="fine-detail-label">Loan Amount</div>
                <div class="fine-detail-value">Ksh{{ fine.loan_amount|floatformat:0 }}</div>
              </div>
              <div class="fine-detail-item">
                <div class="fine-detail-label">Loan Balance</div>
                <div class="fine-detail-value">Ksh{{ fine.loan_balance|floatformat:0 }}</div>
              </div>
              <div class="fine-detail-item">
                <div class="fine-detail-label">Fine Amount</div>
                <div class="fine-detail-value">Ksh{{ fine.fine_amount|floatformat:0 }}</div>
              </div>
              <div class="fine-detail-item">
                <div class="fine-detail-label">Fine Balance</div>
                <div class="fine-detail-value">Ksh{{ fine.fine_balance|floatformat:0 }}</div>
              </div>
            </div>
            <form class="update-fine-form">
              <input type="hidden" id="fine-id" value="{{ fine.id }}">
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <label for="fine-payment-{{ fine.id }}">Fine Payment</label>
                    <input type="number" name="fine-amount" class="form-input" id="fine-payment-{{ fine.id }}" placeholder="Enter payment amount">
                  </div>
                </div>
              </div>
              <button type="button" class="update-fine-btn beautiful-btn update-fine-button">
                Update Payment
              </button>
            </form>
          </div>
        </div>
        {% empty %}
        <div class="no-fines">
          <i class='bx bx-inbox'></i>
          <p>No active loan fines</p>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Contribution Fines Tab Content -->
    <div class="mobile-tab-content" id="contribution-fines">
      <div class="mobile-contribution-update-alerts-hub"></div>
      <div class="mobile-fines-list">
        {% for fine in contribution_fines %}
        <div class="fine-payment-card">
          <div class="fine-payment-header">
            <div class="fine-member-info">
              {% if fine.member.profile %}
              <div class="fine-avatar" style="background-image: url({{fine.member.profile.url}});"></div>
              {% else %}
              <div class="fine-avatar"></div>
              {% endif %}
              <div class="fine-member-details">
                <h6>{{ fine.member.name }}</h6>
                <p>{{ fine.contribution.name }} - Ksh{{ fine.fine_amount|floatformat:0 }}</p>
              </div>
            </div>
            <i class="bx bx-chevron-down fine-toggle"></i>
          </div>
          <div class="fine-payment-content">
            <div class="fine-details-grid">
              <div class="fine-detail-item">
                <div class="fine-detail-label">Contribution Name</div>
                <div class="fine-detail-value">{{ fine.contribution.name }}</div>
              </div>
              <div class="fine-detail-item">
                <div class="fine-detail-label">Contribution Amount</div>
                <div class="fine-detail-value">Ksh{{ fine.contribution.amount|floatformat:0 }}</div>
              </div>
              <div class="fine-detail-item">
                <div class="fine-detail-label">Contribution Balance</div>
                <div class="fine-detail-value">Ksh{{ fine.contribution_balance|floatformat:0 }}</div>
              </div>
              <div class="fine-detail-item">
                <div class="fine-detail-label">Fine Amount</div>
                <div class="fine-detail-value">Ksh{{ fine.fine_amount|floatformat:0 }}</div>
              </div>
              <div class="fine-detail-item">
                <div class="fine-detail-label">Fine Balance</div>
                <div class="fine-detail-value">Ksh{{ fine.fine_balance|floatformat:0 }}</div>
              </div>
            </div>
            <form class="update-fine-form">
              <input type="hidden" id="fine-id" value="{{ fine.id }}">
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <label for="contribution-fine-payment-{{ fine.id }}">Fine Payment</label>
                    <input type="number" name="fine-amount" class="form-input" id="contribution-fine-payment-{{ fine.id }}" placeholder="Enter payment amount">
                  </div>
                </div>
              </div>
              <button type="button" class="update-fine-btn beautiful-btn update-fine-button">
                Update Payment
              </button>
            </form>
          </div>
        </div>
        {% empty %}
        <div class="no-fines">
          <i class='bx bx-inbox'></i>
          <p>No active contribution fines</p>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Group Fines Tab Content -->
    <div class="mobile-tab-content" id="group-fines">
      <div class="mobile-fines-list">
        <div class="fine-section-header">
          <h6>Loan Fines</h6>
        </div>
        {% for fine in fines %}
        <div class="fine-view-card">
          <div class="fine-view-row">
            <div class="fine-view-label">Member</div>
            <div class="fine-view-value">{{ fine.member.name }}</div>
            <div class="fine-view-label">Type</div>
            <div class="fine-view-value">{{ fine.fine_type.name }}</div>
          </div>
          <div class="fine-view-row">
            <div class="fine-view-label">Amount</div>
            <div class="fine-view-value">Ksh{{ fine.fine_amount|floatformat:0 }}</div>
            <div class="fine-view-label">Balance</div>
            <div class="fine-view-value">Ksh{{ fine.fine_balance|floatformat:0 }}</div>
          </div>
          <div class="fine-view-row">
            <div class="fine-view-label">Status</div>
            <div class="fine-view-value">{{ fine.status }}</div>
            <div class="fine-view-label">Date</div>
            <div class="fine-view-value">{{ fine.created|date:"d/m/Y" }}</div>
          </div>
        </div>
        {% empty %}
        <div class="no-fines">
          <i class='bx bx-inbox'></i>
          <p>No loan fines</p>
        </div>
        {% endfor %}

        <div class="fine-section-header">
          <h6>Contribution Fines</h6>
        </div>
        {% for fine in contribution_fines %}
        <div class="fine-view-card">
          <div class="fine-view-row">
            <div class="fine-view-label">Member</div>
            <div class="fine-view-value">{{ fine.member.name }}</div>
            <div class="fine-view-label">Type</div>
            <div class="fine-view-value">{{ fine.fine_type.name }}</div>
          </div>
          <div class="fine-view-row">
            <div class="fine-view-label">Amount</div>
            <div class="fine-view-value">Ksh{{ fine.fine_amount|floatformat:0 }}</div>
            <div class="fine-view-label">Balance</div>
            <div class="fine-view-value">Ksh{{ fine.fine_balance|floatformat:0 }}</div>
          </div>
          <div class="fine-view-row">
            <div class="fine-view-label">Status</div>
            <div class="fine-view-value">{{ fine.status }}</div>
            <div class="fine-view-label">Date</div>
            <div class="fine-view-value">{{ fine.created|date:"d/m/Y" }}</div>
          </div>
        </div>
        {% empty %}
        <div class="no-fines">
          <i class='bx bx-inbox'></i>
          <p>No contribution fines</p>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- My Loan Fines Tab Content -->
    <div class="mobile-tab-content" id="my-loan-fines">
      <div class="mobile-fines-list">
        {% for fine in my_loan_fines %}
        <div class="fine-view-card">
          <div class="fine-view-row">
            <div class="fine-view-label">Type</div>
            <div class="fine-view-value">{{ fine.fine_type.name }}</div>
            <div class="fine-view-label">Amount</div>
            <div class="fine-view-value">Ksh{{ fine.fine_amount|floatformat:0 }}</div>
          </div>
          <div class="fine-view-row">
            <div class="fine-view-label">Paid</div>
            <div class="fine-view-value">Ksh{{ fine.paid_fine_amount|floatformat:0 }}</div>
            <div class="fine-view-label">Balance</div>
            <div class="fine-view-value">Ksh{{ fine.fine_balance|floatformat:0 }}</div>
          </div>
          <div class="fine-view-row">
            <div class="fine-view-label">Status</div>
            <div class="fine-view-value">{{ fine.status }}</div>
            <div class="fine-view-label">Date</div>
            <div class="fine-view-value">{{ fine.created|date:"d/m/Y" }}</div>
          </div>
        </div>
        {% empty %}
        <div class="no-fines">
          <i class='bx bx-inbox'></i>
          <p>You have no loan fines</p>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- My Contribution Fines Tab Content -->
    <div class="mobile-tab-content" id="my-contribution-fines">
      <div class="mobile-fines-list">
        {% for fine in my_contribution_fines %}
        <div class="fine-view-card">
          <div class="fine-view-row">
            <div class="fine-view-label">Type</div>
            <div class="fine-view-value">{{ fine.fine_type.name }}</div>
            <div class="fine-view-label">Amount</div>
            <div class="fine-view-value">Ksh{{ fine.fine_amount|floatformat:0 }}</div>
          </div>
          <div class="fine-view-row">
            <div class="fine-view-label">Paid</div>
            <div class="fine-view-value">Ksh{{ fine.paid_fine_amount|floatformat:0 }}</div>
            <div class="fine-view-label">Balance</div>
            <div class="fine-view-value">Ksh{{ fine.fine_balance|floatformat:0 }}</div>
          </div>
          <div class="fine-view-row">
            <div class="fine-view-label">Status</div>
            <div class="fine-view-value">{{ fine.status }}</div>
            <div class="fine-view-label">Date</div>
            <div class="fine-view-value">{{ fine.created|date:"d/m/Y" }}</div>
          </div>
        </div>
        {% empty %}
        <div class="no-fines">
          <i class='bx bx-inbox'></i>
          <p>You have no contribution fines</p>
        </div>
        {% endfor %}
      </div>
    </div>

  </div>

  <!-- Desktop View -->
  <div class="desktop-fines d-none d-lg-block">
    <div class="text-capitalize">
      <div class="row justify-content-center">

        <div class="col-lg-5 col-md-12 col-sm-12 col-12 p-2 body-div admin">
          <h6 class="section-header">Create Fine Type</h6>
          <div class="loan-type-header">
            <svg class="header-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25"
              fill="none">
              <path
                d="M4.5 14.6746H6.75993C7.77079 14.6746 8.79253 14.7799 9.7763 14.9826C11.5166 15.3411 13.3488 15.3845 15.1069 15.1C15.9738 14.9596 16.826 14.7451 17.5975 14.3727C18.2939 14.0366 19.1469 13.5628 19.7199 13.0321C20.2921 12.5022 20.888 11.6349 21.3109 10.9569C21.6736 10.3756 21.4982 9.66235 20.9245 9.22915C20.2873 8.74805 19.3417 8.74815 18.7046 9.22945L16.8974 10.5946C16.197 11.1237 15.432 11.6107 14.5206 11.7561C14.411 11.7736 14.2962 11.7895 14.1764 11.8034M14.1764 11.8034C14.1403 11.8076 14.1038 11.8116 14.0668 11.8154M14.1764 11.8034C14.3222 11.7722 14.4669 11.6822 14.6028 11.5637C15.246 11.0023 15.2866 10.0562 14.7285 9.42925C14.5991 9.28385 14.4475 9.16255 14.2791 9.06205C11.4817 7.39355 7.12942 8.66435 4.5 10.5291M14.1764 11.8034C14.1399 11.8112 14.1033 11.8154 14.0668 11.8154M14.0668 11.8154C13.5434 11.8691 12.9312 11.883 12.2518 11.8188"
                stroke="#2291A5" stroke-width="1.5" stroke-linecap="round" />
              <path
                d="M4.5 9.78613C4.5 8.95771 3.82843 8.28613 3 8.28613C2.17157 8.28613 1.5 8.95771 1.5 9.78613V14.7861C1.5 15.6146 2.17157 16.2861 3 16.2861C3.82843 16.2861 4.5 15.6146 4.5 14.7861V9.78613Z"
                stroke="#2291A5" stroke-width="1.5" />
            </svg>

            <h6 class="header-text">Fine Type</h6>
          </div>
          <div class="alert-hub"></div>

          <form action="" id="create-fine-type" style="width: 100%">
            <div class="input-sect">
              <div class="some-cont">
                <label for="name" class="form-label">Name</label>
                <input type="text" name="name" class="form-control" id="name" required />
              </div>
            </div>
            <div class="input-sect">
              <div class="some-cont">
                <label for="amount" class="form-label">Amount (KSH)</label>
                <input type="number" name="amount" class="form-control" id="amount" required />
              </div>
            </div>
            <div class="some-cont mb-2 desc-area">
              <label for="description" class="form-label">Description</label>
              <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
            </div>
            <button class="btn btn-primary border-0" style="width: 100%">Create</button>
          </form>
        </div>

        <div class="col-lg-5 col-md-12 col-sm-12 col-12 p-2 body-div admin">
          <h6 class="section-header">Impose Fine</h6>
          <div class="loan-type-header">
            <svg class="header-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25"
              fill="none">
              <path
                d="M4.5 14.6746H6.75993C7.77079 14.6746 8.79253 14.7799 9.7763 14.9826C11.5166 15.3411 13.3488 15.3845 15.1069 15.1C15.9738 14.9596 16.826 14.7451 17.5975 14.3727C18.2939 14.0366 19.1469 13.5628 19.7199 13.0321C20.2921 12.5022 20.888 11.6349 21.3109 10.9569C21.6736 10.3756 21.4982 9.66235 20.9245 9.22915C20.2873 8.74805 19.3417 8.74815 18.7046 9.22945L16.8974 10.5946C16.197 11.1237 15.432 11.6107 14.5206 11.7561C14.411 11.7736 14.2962 11.7895 14.1764 11.8034M14.1764 11.8034C14.1403 11.8076 14.1038 11.8116 14.0668 11.8154M14.1764 11.8034C14.3222 11.7722 14.4669 11.6822 14.6028 11.5637C15.246 11.0023 15.2866 10.0562 14.7285 9.42925C14.5991 9.28385 14.4475 9.16255 14.2791 9.06205C11.4817 7.39355 7.12942 8.66435 4.5 10.5291M14.1764 11.8034C14.1399 11.8112 14.1033 11.8154 14.0668 11.8154M14.0668 11.8154C13.5434 11.8691 12.9312 11.883 12.2518 11.8188"
                stroke="#2291A5" stroke-width="1.5" stroke-linecap="round" />
              <path
                d="M4.5 9.78613C4.5 8.95771 3.82843 8.28613 3 8.28613C2.17157 8.28613 1.5 8.95771 1.5 9.78613V14.7861C1.5 15.6146 2.17157 16.2861 3 16.2861C3.82843 16.2861 4.5 15.6146 4.5 14.7861V9.78613Z"
                stroke="#2291A5" stroke-width="1.5" />
            </svg>

            <h6 class="header-text">Impose Fine</h6>
          </div>
          <div class="impose-alerts-hub"></div>

          {% for loan in loans %}
          <div class="member-header">
            <div class="member-header-inner">
              <div class="leading">
                <div class="leading-inner">
                  {%if loan.member.profile%}
                  <div class="fine-profile"
                    style="background-image: url({{loan.member.profile.url}});background-position: center;"></div>
                  {%else%}
                  <div class="fine-profile"></div>
                  {%endif%}
                  <p class="member-name">{{ loan.member.name }}</p>
                </div>
              </div>
            </div>
          </div>
          <div class="loan-single" style="display: none;">
            <div class="loan-row">
              <div class="loan-row-cube">
                <p class="cube-title fw-semibold">Loan amount</p>
                <button class="cube-amount">ksh {{ loan.amount | intcomma }}</button>
              </div>
              <div class="loan-row-cube">
                <p class="cube-title fw-semibold">Loan balance</p>
                <button class="cube-amount">ksh {{ loan.balance | intcomma }}</button>
              </div>
            </div>
            <form action="" style="width: 100%" class="impose-fine-form">
              <input type="hidden" class="loan-id" value="{{ loan.id }}" />
              <div class="input-sect">
                <div class="some-cont">
                  <label for="fine-type" class="cube-title fw-semibold">Fine type</label>
                  <select name="fine-type" class="fine-type">
                    {% for type in fine_types %}
                    <option value="{{ type.id }}">{{ type.name }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </form>
            <button class="impose-fine-button">Impose</button>
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="row justify-content-center">
        <div class="col-lg-10 col-md-12 col-sm-12 col-12 p-2 body-div admin">
          <h6 class="section-header">Pay Fine</h6>
          <div class="loan-type-header">
            <svg class="header-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25"
              fill="none">
              <path
                d="M4.5 14.6746H6.75993C7.77079 14.6746 8.79253 14.7799 9.7763 14.9826C11.5166 15.3411 13.3488 15.3845 15.1069 15.1C15.9738 14.9596 16.826 14.7451 17.5975 14.3727C18.2939 14.0366 19.1469 13.5628 19.7199 13.0321C20.2921 12.5022 20.888 11.6349 21.3109 10.9569C21.6736 10.3756 21.4982 9.66235 20.9245 9.22915C20.2873 8.74805 19.3417 8.74815 18.7046 9.22945L16.8974 10.5946C16.197 11.1237 15.432 11.6107 14.5206 11.7561C14.411 11.7736 14.2962 11.7895 14.1764 11.8034M14.1764 11.8034C14.1403 11.8076 14.1038 11.8116 14.0668 11.8154M14.1764 11.8034C14.3222 11.7722 14.4669 11.6822 14.6028 11.5637C15.246 11.0023 15.2866 10.0562 14.7285 9.42925C14.5991 9.28385 14.4475 9.16255 14.2791 9.06205C11.4817 7.39355 7.12942 8.66435 4.5 10.5291M14.1764 11.8034C14.1399 11.8112 14.1033 11.8154 14.0668 11.8154M14.0668 11.8154C13.5434 11.8691 12.9312 11.883 12.2518 11.8188"
                stroke="#2291A5" stroke-width="1.5" stroke-linecap="round" />
              <path
                d="M4.5 9.78613C4.5 8.95771 3.82843 8.28613 3 8.28613C2.17157 8.28613 1.5 8.95771 1.5 9.78613V14.7861C1.5 15.6146 2.17157 16.2861 3 16.2861C3.82843 16.2861 4.5 15.6146 4.5 14.7861V9.78613Z"
                stroke="#2291A5" stroke-width="1.5" />
            </svg>

            <h6 class="header-text">Pay Fine</h6>
          </div>
          <div class="pay-fine-alerts-hub"></div>

          {%for fine in fines%}
          <div class="member-header">
            <div class="member-header-inner">
              <div class="leading">
                <div class="leading-inner">
                  {%if fine.member.profile%}
                  <div class="fine-profile"
                    style="background-image: url({{fine.member.profile.url}});background-position: center;"></div>
                  {%else%}
                  <div class="fine-profile"></div>
                  {%endif%}
                  <p class="member-name">{{ fine.member.name }}</p>
                </div>
              </div>
            </div>
          </div>
          <div class="loan-single" style="display: none;">
            <div class="loan-row">
              <div class="loan-row-cube">
                <p class="cube-title fw-semibold">Fine amount</p>
                <button class="cube-amount">ksh {{ fine.amount | intcomma }}</button>
              </div>
              <div class="loan-row-cube">
                <p class="cube-title fw-semibold">Fine type</p>
                <button class="cube-amount">{{ fine.type.name }}</button>
              </div>
            </div>
            <form action="" style="width: 100%" class="pay-fine-form">
              <input type="hidden" class="fine-id" value="{{ fine.id }}" />
              <div class="input-sect">
                <div class="some-cont">
                  <label for="pay-amount" class="cube-title fw-semibold">Pay amount</label>
                  <input type="number" name="pay-amount" class="form-control" id="pay-amount" value="{{ fine.amount }}" />
                </div>
              </div>
            </form>
            <button class="pay-fine-button">Pay Fine</button>
          </div>
          {% empty %}
          <div class="no-fines">
            <i class='bx bx-info-circle'></i>
            <p>No Active Loan Fines</p>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Mobile Tab Functionality -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Mobile tab functionality
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.mobile-tab-content');

    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        const targetTab = this.getAttribute('data-tab');
        
        // Remove active class from all buttons and contents
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // Add active class to clicked button and corresponding content
        this.classList.add('active');
        const targetContent = document.getElementById(targetTab);
        if (targetContent) {
          targetContent.classList.add('active');
        }
      });
    });

    // Mobile fine accordion functionality
    const fineToggles = document.querySelectorAll('.fine-toggle');
    
    fineToggles.forEach(toggle => {
      toggle.addEventListener('click', function() {
        const card = this.closest('.fine-member-card, .fine-payment-card');
        const content = card.querySelector('.fine-member-content, .fine-payment-content');
        
        if (content.style.display === 'none' || content.style.display === '') {
          content.style.display = 'block';
          this.style.transform = 'rotate(180deg)';
        } else {
          content.style.display = 'none';
          this.style.transform = 'rotate(0deg)';
        }
      });
    });

    // Desktop functionality
    const memberHeaders = document.querySelectorAll(".member-header");

    memberHeaders.forEach(function (memberHeader) {
      const loanSingle = memberHeader.nextElementSibling;

      // Initially hide the loan details
      loanSingle.style.display = "none";

      // Add click event listener to each member header
      memberHeader.addEventListener("click", function () {
        // Toggle the display of the corresponding loan details
        if (loanSingle.style.display === "none") {
          loanSingle.style.display = "block";
        } else {
          loanSingle.style.display = "none";
        }
      });

      // Add event listener to impose fine button
      const imposeFineButton = loanSingle.querySelector(".impose-fine-button");
      const imposeFineForm = loanSingle.querySelector(".impose-fine-form");
      if (imposeFineButton && imposeFineForm) {
        imposeFineButton.addEventListener("click", function () {
          // Submit the form when the impose fine button is clicked
          imposeFineForm.submit();
        });
      }
    });
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var createFineForm = document.getElementById("create-fine-type");

    if (createFineForm) {
      createFineForm.addEventListener("submit", function (event) {
        event.preventDefault();

        // Get the submit button and disable it to prevent multiple submissions
        var submitButton = createFineForm.querySelector('button[type="submit"], .btn');
        var originalButtonText = submitButton.textContent;
        submitButton.disabled = true;
        submitButton.textContent = "Creating...";

        // Clear any existing alerts
        var alertHub = document.querySelector(".alert-hub");
        if (alertHub) {
          alertHub.innerHTML = "";
        }

        // Extract form values
        var name = document.getElementById("name").value;
        var amount = document.getElementById("amount").value;
        var description = document.getElementById("description").value;

        // Get chama_id from local storage
        var chamaId = localStorage.getItem("groupId");

        // Construct the URL
        var url = `/chamas-bookeeping/create-fine-type/${chamaId}/`;

        // Prepare the data to send
        var data = {
          name: name,
          amount: amount,
          description: description,
        };

        // Send data to the server
        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken"), // Use the correct cookie name
          },
          body: JSON.stringify(data),
        })
          .then((response) => response.json())
          .then((data) => {
            handleFineTypeResponse(data);
          })
          .catch((error) => {
            console.error("Error:", error);
            // Show error message
            if (alertHub) {
              alertHub.innerHTML = '<div class="alert alert-danger" role="alert">An error occurred while creating the fine type. Please try again.</div>';
            }
          })
          .finally(() => {
            // Re-enable the button
            submitButton.disabled = false;
            submitButton.textContent = originalButtonText;
          });
      });
    }

    // Mobile create fine form
    var mobileCreateFineForm = document.getElementById("mobile-create-fine-form");

    if (mobileCreateFineForm) {
      mobileCreateFineForm.addEventListener("submit", function (event) {
        event.preventDefault();

        // Get the submit button and disable it to prevent multiple submissions
        var submitButton = mobileCreateFineForm.querySelector('button[type="submit"]');
        var originalButtonText = submitButton.textContent;
        submitButton.disabled = true;
        submitButton.textContent = "Creating...";

        // Clear any existing alerts
        var mobileAlertHub = document.querySelector(".mobile-alert-hub");
        if (mobileAlertHub) {
          mobileAlertHub.innerHTML = "";
        }

        // Extract form values
        var name = document.getElementById("mobile-fine-name").value;
        var amount = document.getElementById("mobile-fine-amount").value;
        var description = document.getElementById("mobile-fine-description").value;

        // Get chama_id from local storage
        var chamaId = localStorage.getItem("groupId");

        // Construct the URL
        var url = `/chamas-bookeeping/create-fine-type/${chamaId}/`;

        // Prepare the data to send
        var data = {
          name: name,
          amount: amount,
          description: description,
        };

        // Send data to the server
        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken"), // Use the correct cookie name
          },
          body: JSON.stringify(data),
        })
          .then((response) => response.json())
          .then((data) => {
            handleFineTypeResponse(data);
          })
          .catch((error) => {
            console.error("Error:", error);
            // Show error message
            if (mobileAlertHub) {
              mobileAlertHub.innerHTML = '<div class="alert alert-danger" role="alert">An error occurred while creating the fine type. Please try again.</div>';
            }
          })
          .finally(() => {
            // Re-enable the button
            submitButton.disabled = false;
            submitButton.textContent = originalButtonText;
          });
      });
    }
  });

  function handleFineTypeResponse(data) {
    var alertHub = document.querySelector(".alert-hub");
    var mobileAlertHub = document.querySelector(".mobile-alert-hub");

    var alertHTML = "";
    if (data.status === "success") {
      alertHTML = `<div class="alert alert-success" role="alert">${data.message}</div>`;
      // Clear form inputs on success in mobile view
      if (mobileAlertHub) {
        document.getElementById("mobile-fine-name").value = "";
        document.getElementById("mobile-fine-amount").value = "";
        document.getElementById("mobile-fine-description").value = "";
      }
      // Clear form inputs on success in desktop view
      if (alertHub) {
        document.getElementById("name").value = "";
        document.getElementById("amount").value = "";
        document.getElementById("description").value = "";
      }
    } else {
      alertHTML = `<div class="alert alert-danger" role="alert">${data.message}</div>`;
    }

    // Display alert in desktop view if element exists
    if (alertHub) {
      alertHub.innerHTML = alertHTML;
    }
    
    // Display alert in mobile view if element exists
    if (mobileAlertHub) {
      mobileAlertHub.innerHTML = alertHTML;
    }
  }

  function handleFineContributionResponse(data) {
    var alerthub = document.querySelector(".fine-contribution-hub")
    if (data.status === "success"){
      alerthub.innerHTML = `<div class="alert alert-success" role="alert">${data.message}</div>`;
    } else {
      alerthub.innerHTML = `<div class="alert alert-danger" role="alert">${data.message}</div>`;
    }
  }

  function getCookie(name) {
    var value = "; " + document.cookie;
    var parts = value.split("; " + name + "=");
    if (parts.length == 2) return parts.pop().split(";").shift();
  }
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var imposeFineButtons = document.querySelectorAll('.impose-fine-button');

    imposeFineButtons.forEach(function (button) {
      button.addEventListener('click', function () {
        // Disable button to prevent multiple submissions
        var originalButtonText = this.textContent;
        this.disabled = true;
        this.textContent = "Imposing...";

        // Clear any existing alerts
        var alertHub = document.querySelector('.impose-alerts-hub');
        var mobileAlertHub = document.querySelector('.mobile-impose-alerts-hub');
        if (alertHub) alertHub.innerHTML = "";
        if (mobileAlertHub) mobileAlertHub.innerHTML = "";

        var loanId = this.closest('.loan-single, .fine-member-content').querySelector('.loan-id').value;
        var fineType = this.closest('.loan-single, .fine-member-content').querySelector('.fine-type').value;

        // Construct the URL
        var url = `/chamas-bookeeping/impose-fine/`;

        // Prepare the data to send
        var data = {
          loan_id: loanId,
          fine_type: fineType
        };

        var currentButton = this;

        // Send data to the server
        fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')  // Use the correct cookie name
          },
          body: JSON.stringify(data)
        })
          .then(response => response.json())
          .then(data => {
            handleImposeFineResponse(data);
          })
          .catch(error => {
            console.error('Error:', error);
            // Show error message
            var errorHTML = '<div class="alert alert-danger" role="alert">An error occurred while imposing the fine. Please try again.</div>';
            if (alertHub) alertHub.innerHTML = errorHTML;
            if (mobileAlertHub) mobileAlertHub.innerHTML = errorHTML;
          })
          .finally(() => {
            // Re-enable button
            currentButton.disabled = false;
            currentButton.textContent = originalButtonText;
          });
      });
    });
  });

  function handleImposeFineResponse(data) {
    var alertHub = document.querySelector('.impose-alerts-hub');
    var mobileAlertHub = document.querySelector('.mobile-impose-alerts-hub');

    var alertHTML = "";
    if (data.status === 'success') {
      alertHTML = `<div class="alert alert-success" role="alert">${data.message}</div>`;
    } else {
      alertHTML = `<div class="alert alert-danger" role="alert">${data.message}</div>`;
    }

    // Display alert in desktop view if element exists
    if (alertHub) {
      alertHub.innerHTML = alertHTML;
    }
    
    // Display alert in mobile view if element exists
    if (mobileAlertHub) {
      mobileAlertHub.innerHTML = alertHTML;
    }
  }

  function getCookie(name) {
    var value = "; " + document.cookie;
    var parts = value.split("; " + name + "=");
    if (parts.length == 2) return parts.pop().split(";").shift();
  }
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var updateFineButtons = document.querySelectorAll('.update-fine-button');

    updateFineButtons.forEach(function (button) {
      button.addEventListener('click', function () {
        // Disable button to prevent multiple submissions
        var originalButtonText = this.textContent;
        this.disabled = true;
        this.textContent = "Updating...";

        // Clear any existing alerts
        var alertHub = document.querySelector('.pay-fine-alerts-hub');
        var mobileUpdateAlertHub = document.querySelector('.mobile-update-alerts-hub');
        var mobileContributionUpdateAlertHub = document.querySelector('.mobile-contribution-update-alerts-hub');
        if (alertHub) alertHub.innerHTML = "";
        if (mobileUpdateAlertHub) mobileUpdateAlertHub.innerHTML = "";
        if (mobileContributionUpdateAlertHub) mobileContributionUpdateAlertHub.innerHTML = "";

        var fineId = this.closest('.loan-single, .fine-payment-content').querySelector('#fine-id').value;
        var fineAmountInput = this.closest('.loan-single, .fine-payment-content').querySelector('#amount, .form-input[name="fine-amount"]');
        var fineAmount = fineAmountInput ? fineAmountInput.value : '';

        // Construct the URL
        var url = `/chamas-bookeeping/update-fine/`;

        // Prepare the data to send
        var data = {
          fine_id: fineId,
          'fine-amount': fineAmount
        };

        var currentButton = this;

        // Send data to the server
        fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')  // Use the correct cookie name
          },
          body: JSON.stringify(data)
        })
          .then(response => response.json())
          .then(data => {
            handleUpdateFineResponse(data);
            // Clear input field on success
            if (data.status === 'success' && fineAmountInput) {
              fineAmountInput.value = '';
            }
          })
          .catch(error => {
            console.error('Error:', error);
            // Show error message
            var errorHTML = '<div class="alert alert-danger" role="alert">An error occurred while updating the fine. Please try again.</div>';
            if (alertHub) alertHub.innerHTML = errorHTML;
            if (mobileUpdateAlertHub) mobileUpdateAlertHub.innerHTML = errorHTML;
            if (mobileContributionUpdateAlertHub) mobileContributionUpdateAlertHub.innerHTML = errorHTML;
          })
          .finally(() => {
            // Re-enable button
            currentButton.disabled = false;
            currentButton.textContent = originalButtonText;
          });
      });
    });
  });

  function handleUpdateFineResponse(data) {
    var alertHub = document.querySelector('.pay-fine-alerts-hub');
    var mobileUpdateAlertHub = document.querySelector('.mobile-update-alerts-hub');
    var mobileContributionUpdateAlertHub = document.querySelector('.mobile-contribution-update-alerts-hub');

    var alertHTML = "";
    if (data.status === 'success') {
      alertHTML = `<div class="alert alert-success" role="alert">${data.message}</div>`;
    } else {
      alertHTML = `<div class="alert alert-danger" role="alert">${data.message}</div>`;
    }

    // Display alert in desktop view if element exists
    if (alertHub) {
      alertHub.innerHTML = alertHTML;
    }
    
    // Display alert in mobile loan fines view if element exists
    if (mobileUpdateAlertHub) {
      mobileUpdateAlertHub.innerHTML = alertHTML;
    }

    // Display alert in mobile contribution fines view if element exists
    if (mobileContributionUpdateAlertHub) {
      mobileContributionUpdateAlertHub.innerHTML = alertHTML;
    }
  }

  function getCookie(name) {
    var value = "; " + document.cookie;
    var parts = value.split("; " + name + "=");
    if (parts.length == 2) return parts.pop().split(";").shift();
  }

  // Function to generate initials from name
  function getInitials(name) {
    if (!name) return '??';
    const nameParts = name.trim().split(/\s+/);
    if (nameParts.length >= 2) {
      return (nameParts[0][0] + nameParts[nameParts.length - 1][0]).toUpperCase();
    } else if (nameParts[0].length >= 2) {
      return (nameParts[0][0] + nameParts[0][1]).toUpperCase();
    } else {
      return (nameParts[0][0] + '?').toUpperCase();
    }
  }

  // Replace empty avatars with initials
  document.addEventListener('DOMContentLoaded', function() {
    const avatars = document.querySelectorAll('.fine-avatar, .fine-profile');
    avatars.forEach(avatar => {
      // If avatar has no background image and no content, add initials
      const hasBackgroundImage = avatar.style.backgroundImage && avatar.style.backgroundImage !== 'none';
      const hasContent = avatar.textContent.trim().length > 0;
      
      if (!hasBackgroundImage && !hasContent) {
        // Find the member name in the same container
        const memberContainer = avatar.closest('.fine-member-card, .fine-payment-card, .fine-card, .single-loan');
        if (memberContainer) {
          const memberNameElement = memberContainer.querySelector('.fine-member-details h6, .member-name, h5');
          if (memberNameElement) {
            const memberName = memberNameElement.textContent.trim();
            avatar.textContent = getInitials(memberName);
          }
        }
      }
    });
  });
</script>

{%endblock%}