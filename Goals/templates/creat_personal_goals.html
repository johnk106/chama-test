{% extends 'goal_base.html' %}

{% load static %}
{% block title %}
    Create Goal
{% endblock %}
{% block content %}
    <div class="wrapper">


        <main role="main" class="main-content p-0">

            <header class=" weknz_header">
                <div class="container">
                    <nav class="page_nav mob_nav">
                        <div class="brand">
                            <a href="#">
                                <img src="{% static 'images/Chama-Bora_clrd.png' %}" alt="">
                            </a>
                        </div>
                        <ul class="nav-list">

                            <li class="">

                                <button class="btn"
                                        type="button"
                                        data-bs-dismiss="offcanvas"
                                        aria-label="Close">

                                    <img src="{% static 'images/left_arrow.png' %}" alt="">
                                </button>
                            </li>
                        </ul>
                    </nav>
                </div>
            </header>
            <section class="banner wekenz-banner">
                <div class="container">
                    <div class="wekenza_content">
                        <h2 class="wekenz_h">
                            Create a New<br> Personal Goal
                        </h2>
                        <p class="sub_heading">
                            What are you saving for?</p>

                    </div>

                </div>
            </section>
            <section class="creat_goals">
                <div class="container">

                    <div class="savings_row pb-4">
                        <h4 class="Goals_heading fw_400 mt-3 mb-1 pb-0 ">
                            Select Goal Type
                        </h4>
                        <div class="gol_type card_border d-flex align-items-center justify-content-between ps-4 pe-4">
                            <div class="d-flex flex-column justify-content-center align-items-center">
                                <div class="dirty_c d-flex align-items-center justify-content-center">
                                    <img src="{% static 'images/dirty.png' %}" alt="">
                                </div>
                                <p class="dirty_text">
                                    6.5% Interest
                                    <br> Regular Saving
                                </p>
                            </div>
                            <div class="d-flex flex-column justify-content-center align-items-center">
                                <div class="dirty_c d-flex align-items-center justify-content-center">
                                    <img src="{% static 'images/dirty.png' %}" alt="">
                                </div>
                                <p class="dirty_text">
                                    6.5% Interest
                                    <br> Regular Saving
                                </p>
                            </div>
                        </div>
                        <form action="" method="post" class="mt-3">
                            {% csrf_token %}
                            <div>
                                <label for="neme_your_goals" class="Goals_heading fw_400 mt-3 mb-1 pb-0 ">
                                    Select goal type
                                </label>


                                <select name="saving_type_input" class="text-start">
                                    <option value="Select"> Select goal saving type</option>
                                    <option value="regular" selected> Regular Saving (6% intrest per anum)</option>
                                    <option value="fixed"> Fixed Saving (10 % intrest per anum)</option>

                                </select>
                            </div>
                            <div>
                                <label for="neme_your_goals" class="Goals_heading fw_400 mt-3 mb-1 pb-0 ">
                                    Name Your Goal
                                </label>
                                <input type="text" class="text-start" name="goal_title" required>


                            </div>
                            <div>
                                <label for="target-amount" class="Goals_heading fw_400 mt-3 mb-1 pb-0 ">
                                    Target Amount
                                </label>
                                <input type="number" name="target_amount" id="target-amount" placeholder="Target Amount"
                                       required>
                            </div>
                            {#                            <div>#}
                            {#                                <label for="goal_name" class="Goals_heading fw_400 mt-3 mb-1 pb-0 ">#}
                            {#                                    Group Goal Mission:#}
                            {#                                </label>#}
                            {#                                <textarea type="text" name="goal_name" id="goal_name"#}
                            {#                                          placeholder="Name your Goal"></textarea>#}
                            {#                            </div>#}
                            <div class="check_box d-flex align-items-center">
                                <input type="checkbox" name="is_saving_or_goal" id="is_saving_or_goal">
                                <h6 class="check_box_content ms-2 mb-0">
                                    No target. Just want to save
                                </h6>
                            </div>
                            <div>
                                <label for="start_date" class="Goals_heading fw_400 mt-3 mb-1 pb-0 ">
                                    Start Date
                                </label>
                                <input type="date" name="start_date" id="start_date" placeholder="Start Date" required>
                            </div>
                            <div>
                                <label for="end_date" class="Goals_heading fw_400 mt-3 mb-1 pb-0 ">
                                    End Date
                                </label>
                                <input type="date" name="end_date" id="end_date" placeholder="Start Date" required>
                            </div>
                            <div class="check_box d-flex align-items-center">
                                <input type="checkbox" name="just_want_to_save" id="just_want_to_save">
                                <h6 class="check_box_content ms-2 mb-0">
                                    Just want to save
                                </h6>
                            </div>

                            <div class="d-flex flex-row align-items-center justify-content-between gap_40">
                                  <div>
                                    <label for="neme_your_goals" class="Goals_heading fw_400 mt-3 mb-1 pb-0 ">
                                        Frequency
                                    </label>

                                    <select name="select_payment_frequency" id="select_payment_frequency"
                                            class="text-start">
                                        <option value="monthly" selected> Monthly</option>
                                        <option value="weekly"> Weekly</option>

                                    </select>
                                </div>

                                <div>
                                    <label for="amount-to-save" class="Goals_heading fw_400 mt-3 mb-1 pb-0 ">
                                        Amount to Save
                                    </label>
                                    <input type="number" name="amount_to_save" id="calculated-amount"
                                           placeholder="Amount to Save" readonly>
                                </div>

                            </div>
                            <div>
                                <h4 class="Goals_heading fw_400 mt-3 mb-1 pb-0 ">
                                    Reminders Frequency
                                </h4>
                                <div class="d-flex flex-row align-items-center justify-content-between gap_40">

                                    <div>
                                        <label for="neme_your_goals" class="Goals_heading fw_400 mt-3 mb-1 pb-0 ">
                                            Frequency
                                        </label>

                                        <select name="reminder_frequency" id="neme_your_goals" class="text-start">
                                            <option value="Select"> Select Frequency</option>
                                            <option value="monthly"> Monthly</option>
                                            <option value="weekly"> Weekly</option>

                                        </select>
                                    </div>

                                </div>
                            </div>


                    </div>
                    <div>
                        <button type="submit" class="btn saving_btn ">
                            Set Goal
                        </button>
                    </div>
                    </form>
                </div>
            </section>

        </main>
    </div>

    <script>
        // Get references to the checkbox and the end_date field
        const justWantToSaveCheckbox = document.getElementById("just_want_to_save");
        const issavingorgoal = document.getElementById("is_saving_or_goal");
        const endDateField = document.getElementById("end_date");
        const target_amount = document.getElementById("target-amount");


        const amountToSaveField = document.getElementById("calculated-amount");

        // Add an event listener to the checkbox
        justWantToSaveCheckbox.addEventListener("change", function () {
            // If the checkbox is checked, disable the end_date field; otherwise, enable it
            endDateField.disabled = this.checked;

            // Clear the end_date field's value if disabling
            if (this.checked) {
                endDateField.value = "";
                amountToSaveField.removeAttribute("readonly");
            } else {
                amountToSaveField.setAttribute("readonly", "");
            }
        });
        issavingorgoal.addEventListener("change", function () {
            // If the checkbox is checked, disable the end_date field; otherwise, enable it
            target_amount.disabled = this.checked;

            // Clear the end_date field's value if disabling
            if (this.checked) {
                target_amount.value = "";
                amountToSaveField.removeAttribute("readonly");
            } else {
                amountToSaveField.setAttribute("readonly", "");
            }
        });
    </script>




    <script>
        // Function to calculate the difference in months between two dates
        function monthsDifference(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);

            const months = (end.getFullYear() - start.getFullYear()) * 12 + end.getMonth() - start.getMonth();

            return months;
        }

        function weeksDifference(startDate, endDate) {
            const oneDayInMilliseconds = 24 * 60 * 60 * 1000;
            const start = new Date(startDate);
            const end = new Date(endDate);

            const differenceInMilliseconds = Math.abs(end - start);
            const weeks = Math.floor(differenceInMilliseconds / (7 * oneDayInMilliseconds));

            return weeks;
        }


        // Function to calculate the monthly amount
        function calculateMonthlyAmount() {
            const startDate = document.getElementById("start_date").value;
            const endDate = document.getElementById("end_date").value;
            const payment_frequency = document.getElementById("select_payment_frequency").value;
            const targetAmount = parseFloat(document.getElementById("target-amount").value);
            if (payment_frequency === 'monthly') {
                const months = monthsDifference(startDate, endDate);

                if (months > 0) {
                    const calculatedAmount = targetAmount / months;
                    document.getElementById("calculated-amount").value = calculatedAmount.toFixed(2);
                } else {
                    document.getElementById("calculated-amount").value = "";
                }

            }
            if (payment_frequency === 'weekly') {
                const weeks = weeksDifference(startDate, endDate);

                if (weeks > 0) {
                    const calculatedAmount = targetAmount / weeks;
                    document.getElementById("calculated-amount").value = calculatedAmount.toFixed(2);
                } else {
                    document.getElementById("calculated-amount").value = "";
                }

            }


        }

        // Attach the calculateMonthlyAmount function to the change event of start_date, end_date, and target-amount fields
        document.getElementById("start_date").addEventListener("change", calculateMonthlyAmount);
        document.getElementById("end_date").addEventListener("change", calculateMonthlyAmount);
        document.getElementById("select_payment_frequency").addEventListener("change", calculateMonthlyAmount);
        document.getElementById("target-amount").addEventListener("input", calculateMonthlyAmount);
    </script>


{% endblock %}